# Brick Game Common Library (s21_bgame)

s21_bgame — это универсальная библиотека на языке C для управления несколькими консольными "кирпичными" играми, такими как Tetris и Snake. Библиотека предоставляет модульный фреймворк для регистрации игр, переключения между ними и унифицированного взаимодействия через общий API.

Разработана как часть проекта s21_brick_game и предназначена для использования в составе более крупного приложения, реализующего классические аркадные игры.

## Основные возможности

- Регистрация игр по уникальному идентификатору (GameId_t)
- Динамическое переключение между играми без перезагрузки
- Унифицированный интерфейс (GameInterface_t) для всех игр
- Безопасный доступ к состоянию игры через GameInfo_t
- Поддержка ввода пользователя через единый API
- Потоконебезопасная (предполагается однопоточный режим)
- Полностью настраиваемая сборка (статическая/динамическая библиотека)

## Структура проекта

```
brick_game/common/
├── s21_bgame.h         # Основной заголовочный файл
├── s21_bgame.c         # Реализация фреймворка
├── tests/
│   └── test_bgame.c    # Unit-тесты (CMocka)
├── Makefile            # Система сборки
└── Doxyfile            # Конфигурация Doxygen
```

## API: Ключевые компоненты

### GameId_t — Идентификаторы игр

```c
typedef enum {
  GAME_TETRIS = 0,
  GAME_SNAKE = 1
} GameId_t;
```

### UserAction_t — Действия пользователя

```c
typedef enum {
  Start, Pause, Terminate,
  Left, Right, Up, Down, Action
} UserAction_t;
```

### GameInterface_t — Интерфейс игры

Структура с виртуальными функциями:

create() — создаёт экземпляр
destroy() — уничтожает экземпляр
input() — обработка ввода
update() — игровой тик
get_info() — получение состояния

### Глобальные функции
bg_register_game() — регистрация игры
bg_switch_game() — переключение на игру
userInput() — отправка ввода
updateCurrentState() — получение состояния

Использование

1. Регистрация игры
```c
GameInterface_t tetris_iface = tetris_get_interface(GAME_TETRIS);
bg_register_game(tetris_iface);
```
2. Переключение на игру
```c
if (bg_switch_game(GAME_TETRIS)) {
    printf("Игра запущена!\n");
}
```
3. Обработка ввода
```c
userInput(Left, false);   // Движение влево
userInput(Down, true);    // Ускоренное падение
userInput(Action, false); // Поворот фигуры
```
4. Получение состояния
```c
GameInfo_t info = updateCurrentState();
// info.field — игровое поле
// info.score — счёт
// info.pause — пауза
```

## Тестирование

Библиотека покрыта полным набором unit-тестов на базе CMocka, включая проверки:

Регистрации и получения игр
Переключения между играми
Обработки ввода
Обновления состояния
Граничных случаев (ошибки создания, переполнение реестра)
Запуск тестов:

```bash
make test
```

Тесты включают проверку:

Утечек памяти (valgrind)
Стиля кода (clang-format)
Статический анализ (cppcheck)
Покрытия кода (gcov, lcov)

### Покрытие и безопасность

Покрытие кода: >90% (с отчётом в HTML)
Обработка ошибок: защита от NULL-указателей, валидация интерфейса
Ленивая инициализация: реестр инициализируется при первом использовании
Ограничение регистра: до 8 игр (настраиваемо)

## Сборка

Поддерживается статическая и динамическая сборка.

Сборка библиотеки
```bash
make                    # Собрать (по умолчанию — статическую)
make LIBTYPE=dynamic    # Собрать динамическую
make install            # Установить в систему
```

## Зависимости

gcc, make
clang-format, cppcheck (линтинг)
cmocka, valgrind, lcov (тестирование)
doxygen, graphviz (документация)

## Документация

Автоматически генерируемая документация с помощью Doxygen:

```bash
make dvi
```
Результат: docs/html/index.html

## Очистка
```bash
make clean
```
## Лицензия
MIT — свободное использование и модификация.

## Автор
provemet
Разработчик игрового фреймворка
Дата: 2025

### Совет: 
Для разработки новых игр реализуйте GameInterface_t и зарегистрируйте через bg_register_game(). Библиотека автоматически интегрирует её в систему.